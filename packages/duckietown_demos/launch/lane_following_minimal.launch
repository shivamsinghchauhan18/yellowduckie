<?xml version="1.0" encoding="utf-8"?>
<launch>
    <arg name="veh" default="$(env VEHICLE_NAME)" doc="Name of the vehicle"/>
    <arg name="config" default="baseline"/>
    <arg name="param_file_name" default="default"/>
    
    <!-- FSM Node -->
    <include file="$(find fsm)/launch/fsm_node.launch">
        <arg name="veh" value="$(arg veh)"/>
        <arg name="param_file_name" value="$(arg param_file_name)"/>
    </include>
    
    <!-- Camera Node -->
    <include file="$(find camera)/launch/camera_node.launch">
        <arg name="veh" value="$(arg veh)"/>
        <arg name="config" value="$(arg config)"/>
    </include>
    
    <!-- Line Detector -->
    <group ns="$(arg veh)">
        <remap from="line_detector_node/image/compressed" to="/$(arg veh)/camera_node/image/compressed"/>
        <include file="$(find line_detector)/launch/line_detector_node.launch">
            <arg name="veh" value="$(arg veh)"/>
            <arg name="param_file_name" value="$(arg param_file_name)"/>
        </include>
    </group>
    
    <!-- Ground Projection -->
    <group ns="$(arg veh)">
        <remap from="ground_projection_node/lineseglist_in" to="/$(arg veh)/line_detector_node/segment_list"/>
        <remap from="ground_projection_node/camera_info" to="/$(arg veh)/camera_node/camera_info"/>
        <include file="$(find ground_projection)/launch/ground_projection_node.launch">
            <arg name="veh" value="$(arg veh)"/>
            <arg name="param_file_name" value="$(arg param_file_name)"/>
        </include>
    </group>
    
    <!-- Lane Filter -->
    <group ns="$(arg veh)">
        <remap from="lane_filter_node/segment_list" to="/$(arg veh)/ground_projection_node/lineseglist_out"/>
        <remap from="lane_filter_node/fsm_mode" to="/$(arg veh)/fsm_node/mode"/>
        <include file="$(find lane_filter)/launch/lane_filter_node.launch">
            <arg name="veh" value="$(arg veh)"/>
            <arg name="param_file_name" value="$(arg param_file_name)"/>
        </include>
    </group>
    
    <!-- Lane Controller -->
    <group ns="$(arg veh)">
        <remap from="lane_controller_node/lane_pose" to="/$(arg veh)/lane_filter_node/lane_pose"/>
        <remap from="lane_controller_node/fsm_mode" to="/$(arg veh)/fsm_node/mode"/>
        <include file="$(find lane_control)/launch/lane_controller_node.launch">
            <arg name="veh" value="$(arg veh)"/>
            <arg name="param_file_name" value="$(arg param_file_name)"/>
        </include>
    </group>
    
</launch>