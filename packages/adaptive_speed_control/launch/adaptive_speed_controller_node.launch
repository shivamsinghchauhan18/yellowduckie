<?xml version="1.0" encoding="utf-8"?>
<launch>
    <arg name="veh" default="$(env VEHICLE_NAME)" />
    <arg name="config" default="baseline" />
    <arg name="param_file_name" default="default" />
    <arg name="verbose" default="false" />
    
    <!-- Adaptive Speed Controller Node -->
    <group ns="$(arg veh)">
        <node name="adaptive_speed_controller_node" 
              pkg="adaptive_speed_control" 
              type="adaptive_speed_controller_node.py" 
              output="screen" 
              clear_params="true"
              required="false">
            
            <!-- Load configuration parameters -->
            <rosparam file="$(find adaptive_speed_control)/config/adaptive_speed_controller_node/$(arg param_file_name).yaml" command="load" />
            
            <!-- Topic remappings for integration with existing system -->
            <!-- Input topics -->
            <remap from="~lane_pose" to="/$(arg veh)/lane_filter_node/lane_pose" />
            <remap from="~camera_image" to="/$(arg veh)/camera_node/image/compressed" />
            <remap from="~vehicle_detections" to="/$(arg veh)/vehicle_detection_node/centers" />
            <remap from="~apriltag_detections" to="/$(arg veh)/apriltag_detector_node/detections" />
            <remap from="~stop_line_reading" to="/$(arg veh)/stop_line_filter_node/stop_line_reading" />
            <remap from="~imu_data" to="/$(arg veh)/imu_node/data" />
            <remap from="~collision_risk" to="/$(arg veh)/collision_detection_manager_node/collision_risk" />
            <remap from="~safety_status" to="/$(arg veh)/safety_fusion_manager_node/safety_status" />
            <remap from="~base_speed_command" to="/$(arg veh)/lane_controller_node/car_cmd" />
            
            <!-- Output topics -->
            <remap from="~adaptive_speed_command" to="/$(arg veh)/adaptive_speed_controller_node/car_cmd" />
            
            <!-- Parameters -->
            <param name="~verbose" value="$(arg verbose)" />
            
        </node>
    </group>
</launch>