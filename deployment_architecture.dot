// Duckietown Safe Navigation - Deployment Architecture
// Real-world System Deployment and Hardware Integration
// Render with: dot -Tpng deployment_architecture.dot -o deployment_architecture.png

digraph DeploymentArchitecture {
    rankdir=TB;
    splines=true;
    overlap=false;
    fontname="Arial";
    fontsize=12;
    
    node [fontname="Arial", fontsize=10, style=filled];
    edge [fontname="Arial", fontsize=9];
    
    // Title
    title [label="ðŸš€ DUCKIETOWN SAFE NAVIGATION\nDeployment Architecture & Hardware Integration", 
           shape=box, style="filled,rounded", fillcolor="#e3f2fd", color="#1976d2", fontsize=16, fontcolor="#1976d2"];
    
    // ========== HARDWARE LAYER ==========
    subgraph cluster_hardware {
        label="ðŸ”§ HARDWARE LAYER";
        style=filled;
        color="#f5f5f5";
        fontcolor="#424242";
        fontsize=14;
        
        subgraph cluster_duckiebot {
            label="ðŸ¤– Duckiebot Hardware";
            style=filled;
            color="#e8f5e8";
            fontcolor="#2e7d32";
            
            jetson [label="ðŸ–¥ï¸ NVIDIA Jetson Nano\nâ€¢ ARM Cortex-A57 Quad-core\nâ€¢ 4GB LPDDR4 RAM\nâ€¢ 128-core Maxwell GPU\nâ€¢ Ubuntu 18.04 LTS", 
                   shape=box, fillcolor="#c8e6c9", color="#388e3c"];
            
            camera_hw [label="ðŸ“· Camera Module\nâ€¢ Raspberry Pi Camera v2\nâ€¢ 8MP Sony IMX219\nâ€¢ 1080p30 Video\nâ€¢ CSI-2 Interface", 
                      shape=box, fillcolor="#c8e6c9", color="#388e3c"];
            
            motors [label="âš™ï¸ DC Motors\nâ€¢ Differential Drive\nâ€¢ PWM Control\nâ€¢ Encoder Feedback\nâ€¢ 6V Operation", 
                   shape=box, fillcolor="#c8e6c9", color="#388e3c"];
            
            leds [label="ðŸ’¡ LED Array\nâ€¢ RGB LEDs\nâ€¢ Programmable Patterns\nâ€¢ 360Â° Visibility\nâ€¢ I2C Control", 
                 shape=box, fillcolor="#c8e6c9", color="#388e3c"];
            
            imu_hw [label="ðŸ“Š IMU Sensor\nâ€¢ 9-DOF Motion\nâ€¢ Accelerometer\nâ€¢ Gyroscope\nâ€¢ Magnetometer", 
                   shape=box, fillcolor="#c8e6c9", color="#388e3c"];
            
            battery [label="ðŸ”‹ Battery System\nâ€¢ 7.4V Li-Po\nâ€¢ 2200mAh Capacity\nâ€¢ ~2 Hour Runtime\nâ€¢ USB-C Charging", 
                    shape=box, fillcolor="#c8e6c9", color="#388e3c"];
        }
        
        subgraph cluster_infrastructure {
            label="ðŸ—ï¸ Infrastructure";
            style=filled;
            color="#fff3e0";
            fontcolor="#ef6c00";
            
            duckietown_map [label="ðŸ—ºï¸ Duckietown Map\nâ€¢ Lane Markings\nâ€¢ Traffic Signs\nâ€¢ AprilTags\nâ€¢ Intersections", 
                           shape=box, fillcolor="#ffcc02", color="#f57c00"];
            
            other_duckiebots [label="ðŸ¤– Other Duckiebots\nâ€¢ Multi-agent Environment\nâ€¢ V2V Communication\nâ€¢ Collision Scenarios\nâ€¢ Coordination", 
                             shape=box, fillcolor="#ffb74d", color="#ef6c00"];
            
            network_infra [label="ðŸ“¡ Network Infrastructure\nâ€¢ WiFi Access Points\nâ€¢ ROS Master Node\nâ€¢ Data Collection\nâ€¢ Remote Monitoring", 
                          shape=box, fillcolor="#ffab91", color="#ef6c00"];
        }
    }
    
    // ========== SOFTWARE LAYER ==========
    subgraph cluster_software {
        label="ðŸ’» SOFTWARE LAYER";
        style=filled;
        color="#e8eaf6";
        fontcolor="#3f51b5";
        fontsize=14;
        
        subgraph cluster_os {
            label="Operating System";
            style=filled;
            color="#f3e5f5";
            fontcolor="#7b1fa2";
            
            ubuntu [label="ðŸ§ Ubuntu 18.04 LTS\nâ€¢ Linux Kernel 4.15\nâ€¢ ARM64 Architecture\nâ€¢ Real-time Scheduling\nâ€¢ Device Drivers", 
                   shape=box, fillcolor="#e1bee7", color="#8e24aa"];
            
            ros [label="ðŸ¤– ROS Melodic\nâ€¢ Distributed Computing\nâ€¢ Message Passing\nâ€¢ Node Management\nâ€¢ Parameter Server", 
                shape=box, fillcolor="#ce93d8", color="#7b1fa2"];
            
            docker [label="ðŸ³ Docker Container\nâ€¢ Isolated Environment\nâ€¢ Reproducible Builds\nâ€¢ Easy Deployment\nâ€¢ Version Control", 
                   shape=box, fillcolor="#ba68c8", color="#7b1fa2"];
        }
        
        subgraph cluster_runtime {
            label="Runtime Environment";
            style=filled;
            color="#e1f5fe";
            fontcolor="#0277bd";
            
            python [label="ðŸ Python 3.6+\nâ€¢ NumPy/SciPy\nâ€¢ OpenCV 4.x\nâ€¢ PyTorch/TensorFlow\nâ€¢ ROS Python API", 
                   shape=box, fillcolor="#b3e5fc", color="#0288d1"];
            
            cpp [label="âš¡ C++ Runtime\nâ€¢ Real-time Performance\nâ€¢ Hardware Interfaces\nâ€¢ Optimized Algorithms\nâ€¢ ROS C++ API", 
                shape=box, fillcolor="#81d4fa", color="#0277bd"];
            
            cuda [label="ðŸš€ CUDA Runtime\nâ€¢ GPU Acceleration\nâ€¢ Neural Network Inference\nâ€¢ Parallel Processing\nâ€¢ TensorRT Optimization", 
                 shape=box, fillcolor="#4fc3f7", color="#0277bd"];
        }
    }
    
    // ========== APPLICATION LAYER ==========
    subgraph cluster_application {
        label="ðŸŽ¯ APPLICATION LAYER";
        style=filled;
        color="#e8f5e8";
        fontcolor="#2e7d32";
        fontsize=14;
        
        subgraph cluster_core_apps {
            label="Core Navigation";
            style=filled;
            color="#c8e6c9";
            fontcolor="#388e3c";
            
            perception_stack [label="ðŸ‘ï¸ Perception Stack\nâ€¢ Line Detection\nâ€¢ Object Recognition\nâ€¢ AprilTag Processing\nâ€¢ Ground Projection", 
                             shape=box, fillcolor="#a5d6a7", color="#388e3c"];
            
            control_stack [label="ðŸŽ›ï¸ Control Stack\nâ€¢ Lane Following\nâ€¢ Speed Control\nâ€¢ State Management\nâ€¢ Motor Commands", 
                          shape=box, fillcolor="#81c784", color="#2e7d32"];
            
            safety_stack [label="ðŸ›¡ï¸ Safety Stack\nâ€¢ Emergency Stop\nâ€¢ Collision Avoidance\nâ€¢ Risk Assessment\nâ€¢ Safety Arbitration", 
                         shape=box, fillcolor="#66bb6a", color="#2e7d32"];
        }
        
        subgraph cluster_advanced_apps {
            label="Advanced Features";
            style=filled;
            color="#ffcdd2";
            fontcolor="#c62828";
            
            ai_stack [label="ðŸ§  AI/ML Stack\nâ€¢ Neural Networks\nâ€¢ Trajectory Prediction\nâ€¢ Scene Understanding\nâ€¢ Multi-Object Tracking", 
                     shape=box, fillcolor="#ef9a9a", color="#d32f2f"];
            
            adaptive_stack [label="ðŸš€ Adaptive Systems\nâ€¢ Dynamic Speed Control\nâ€¢ Environmental Adaptation\nâ€¢ Lane Change Logic\nâ€¢ Path Planning", 
                           shape=box, fillcolor="#e57373", color="#c62828"];
            
            communication_stack [label="ðŸ“¡ Communication\nâ€¢ V2V Messaging\nâ€¢ LED Signaling\nâ€¢ Status Broadcasting\nâ€¢ Coordination Protocol", 
                                shape=box, fillcolor="#ef5350", color="#c62828"];
        }
        
        monitoring_stack [label="ðŸ“Š Monitoring & Diagnostics\nâ€¢ Performance Metrics\nâ€¢ Health Monitoring\nâ€¢ Data Logging\nâ€¢ System Analysis", 
                         shape=box, fillcolor="#f5f5f5", color="#424242"];
    }
    
    // ========== DEPLOYMENT CONFIGURATION ==========
    subgraph cluster_deployment {
        label="ðŸš€ DEPLOYMENT CONFIGURATION";
        style=filled;
        color="#fff8e1";
        fontcolor="#f57f17";
        fontsize=14;
        
        launch_files [label="ðŸ“‹ Launch Configuration\nâ€¢ master.launch\nâ€¢ lane_following.launch\nâ€¢ safety_system.launch\nâ€¢ Parameter Files", 
                     shape=box, fillcolor="#fff176", color="#f9a825"];
        
        config_files [label="âš™ï¸ Configuration Files\nâ€¢ YAML Parameters\nâ€¢ Calibration Data\nâ€¢ Safety Thresholds\nâ€¢ Performance Tuning", 
                     shape=box, fillcolor="#ffeb3b", color="#f57f17"];
        
        build_system [label="ðŸ”¨ Build System\nâ€¢ dts devel build\nâ€¢ Docker Compose\nâ€¢ CI/CD Pipeline\nâ€¢ Automated Testing", 
                     shape=box, fillcolor="#fdd835", color="#f57f17"];
    }
    
    // ========== CONNECTIONS ==========
    
    // Hardware to OS
    jetson -> ubuntu [label="boots", color="#4caf50"];
    camera_hw -> ubuntu [label="CSI driver", color="#2196f3"];
    motors -> ubuntu [label="GPIO/PWM", color="#ff9800"];
    leds -> ubuntu [label="I2C driver", color="#ff9800"];
    imu_hw -> ubuntu [label="I2C/SPI", color="#2196f3"];
    battery -> jetson [label="power", color="#f44336"];
    
    // OS to Runtime
    ubuntu -> ros [label="process mgmt", color="#9c27b0"];
    ubuntu -> docker [label="containerization", color="#00bcd4"];
    ros -> python [label="ROS nodes", color="#4caf50"];
    ros -> cpp [label="performance", color="#ff5722"];
    jetson -> cuda [label="GPU access", color="#3f51b5"];
    
    // Runtime to Applications
    python -> perception_stack [label="image processing", color="#2196f3"];
    python -> control_stack [label="control logic", color="#4caf50"];
    python -> ai_stack [label="ML inference", color="#9c27b0"];
    cpp -> safety_stack [label="real-time safety", color="#f44336"];
    cuda -> ai_stack [label="GPU acceleration", color="#3f51b5"];
    
    // Application integration
    perception_stack -> control_stack [label="sensor data", color="#4caf50"];
    perception_stack -> safety_stack [label="object info", color="#f44336"];
    ai_stack -> adaptive_stack [label="predictions", color="#9c27b0"];
    safety_stack -> control_stack [label="safety override", color="#f44336", penwidth=3];
    adaptive_stack -> control_stack [label="adaptive commands", color="#2196f3"];
    
    // Monitoring integration
    control_stack -> monitoring_stack [label="performance data", color="#9e9e9e", style=dashed];
    safety_stack -> monitoring_stack [label="safety events", color="#9e9e9e", style=dashed];
    ai_stack -> monitoring_stack [label="AI metrics", color="#9e9e9e", style=dashed];
    
    // Communication
    communication_stack -> other_duckiebots [label="V2V messages", color="#ff9800"];
    communication_stack -> network_infra [label="status updates", color="#00bcd4"];
    leds -> communication_stack [label="visual signals", color="#ff9800", dir=back];
    
    // Deployment
    build_system -> docker [label="container build", color="#00bcd4"];
    launch_files -> ros [label="node startup", color="#4caf50"];
    config_files -> perception_stack [label="parameters", color="#607d8b", style=dotted];
    config_files -> control_stack [label="tuning", color="#607d8b", style=dotted];
    config_files -> safety_stack [label="thresholds", color="#607d8b", style=dotted];
    
    // Environment interaction
    duckietown_map -> perception_stack [label="visual features", color="#795548"];
    other_duckiebots -> perception_stack [label="vehicle detection", color="#795548"];
    
    // ========== PERFORMANCE ANNOTATIONS ==========
    
    perf1 [label="âš¡ Real-time Performance\nâ€¢ 10Hz perception pipeline\nâ€¢ <100ms safety response\nâ€¢ 30fps camera processing", 
          shape=note, fillcolor="#e8f5e8", color="#2e7d32", pos="15,10!"];
    
    perf2 [label="ðŸ”‹ Power Efficiency\nâ€¢ 2+ hour operation\nâ€¢ Dynamic CPU scaling\nâ€¢ GPU power management", 
          shape=note, fillcolor="#fff3e0", color="#ef6c00", pos="15,8!"];
    
    perf3 [label="ðŸ›¡ï¸ Safety Guarantees\nâ€¢ Hardware emergency stop\nâ€¢ Redundant safety systems\nâ€¢ Fail-safe operation", 
          shape=note, fillcolor="#ffebee", color="#c62828", pos="15,6!"];
    
    perf4 [label="ðŸ“Š Monitoring & Debug\nâ€¢ Real-time diagnostics\nâ€¢ Performance profiling\nâ€¢ Remote debugging", 
          shape=note, fillcolor="#f5f5f5", color="#424242", pos="15,4!"];
    
    // Position title at top
    title -> jetson [style=invis];
}